# Kubernetes 基础架构文档

## 1. Kubernetes 架构概述

Kubernetes 是一个用于自动化部署、扩展和管理容器化应用的开源平台。K8S 的架构分为 **Master 节点** 和 **Worker 节点**，它们各自承担不同的职责，共同工作以维持集群的运行。

- **Master 节点**：负责集群的管理和控制，处理集群的配置、调度、监控等工作。
- **Worker 节点**：负责执行应用的负载，承载 Pod 和容器，进行实际的计算任务。

------

## 2. Kubernetes 核心组件讲解

### Master 节点

Master 节点是 Kubernetes 集群的控制中心，包含多个关键组件，负责整个集群的协调和管理。

#### 核心组件

- **kube-apiserver**：提供集群内部的 RESTful API，是所有组件和用户之间的通信桥梁。
- **kube-controller-manager**：负责监控集群的状态，执行控制循环，确保集群的实际状态与期望状态一致。
- **kube-scheduler**：根据资源需求和调度策略，将 Pod 调度到适合的 Worker 节点。
- **etcd**：分布式键值存储系统，用于存储 Kubernetes 的配置信息和集群状态。

### Worker 节点

Worker 节点负责实际运行和承载应用容器，每个 Worker 节点上有以下组件：

- **kubelet**：负责管理和监控节点上的 Pod 和容器，确保它们按照集群的期望状态运行。
- **kube-proxy**：处理集群内部和外部的网络流量，保证 Pod 和服务之间的连接性。

------

## 3. Kubernetes 核心组件详细介绍

### kube-apiserver

- **功能**：`kube-apiserver` 是 Kubernetes 的核心组件，负责暴露 REST API 供其他组件、用户和外部系统访问。它是与 `etcd` 交互的唯一入口，所有集群的配置和状态信息都通过 API 与 `etcd` 进行交互。

- 作用：

  - 接受和验证所有的 REST API 请求。
  - 通过 API 提供集群的状态信息，协调集群中的操作。
  - 将操作请求通过 `etcd` 存储并同步集群状态。

### kube-controller-manager

- **功能**：`kube-controller-manager` 负责集群中控制器的管理，控制器负责将集群的当前状态转换为期望状态。它包括节点控制器、复制控制器、部署控制器等。

- 作用：

  - 定期查看集群状态，通过 `kube-apiserver` 获取最新状态，执行相关操作。
- 例如，节点控制器检查节点状态并处理节点加入、移除等操作。

### kube-scheduler

- **功能**：`kube-scheduler` 是负责调度 Pod 到适当的节点上，它依据资源需求和调度策略做出决策。

- 作用：

  - 根据资源要求（如 CPU、内存）和调度策略（如亲和性、污点等）选择合适的 Worker 节点进行 Pod 调度。

### kube-proxy

- **功能**：`kube-proxy` 处理集群内部和外部的网络请求，保证 Pod 和服务之间的网络连接。

- 作用：

  - 管理服务代理，创建负载均衡规则，确保服务间的通信。
- 转发流量到对应的 Pod。

### kubelet

- **功能**：`kubelet` 是每个 Worker 节点上的代理，负责执行来自 Master 节点的指令，确保容器按预期运行。

- 作用：

  - 定期拉取 Pod 和容器的状态，报告到 `kube-apiserver`。
- 确保容器的生命周期与集群期望的一致。

### etcd

- **功能**：`etcd` 是 Kubernetes 的分布式键值存储，用于保存集群的所有配置和状态数据。

- 作用：

  - 存储所有的集群状态，包括节点、Pod、服务等信息。
- 只有通过 `kube-apiserver` 与 `etcd` 交互，保证集群配置的可靠性和一致性。

------

## 4. kubeadm 与二进制部署的区别

`kubeadm` 和二进制部署方式是两种常见的 Kubernetes 集群安装方式，它们的组件部署方式有所不同。下面的表格总结了两者的区别：

| 特性           | kubeadm 部署                          | 二进制部署                             |
| -------------- | ------------------------------------- | -------------------------------------- |
| **安装方式**   | 使用 `kubeadm` 工具进行自动化部署     | 手动下载并配置二进制文件               |
| **初始化过程** | `kubeadm init` 一键初始化 Master 节点 | 需要手动配置各个组件                   |
| **组件管理**   | 自动管理集群组件的启动和配置          | 需要手动管理各个组件                   |
| **适用场景**   | 适合生产环境和小型集群                | 适合高级用户和定制化需求               |
| **自动化水平** | 高，自动化程度高                      | 低，需要手动配置和维护                 |
| **配置复杂度** | 低，`kubeadm` 负责大部分配置          | 高，需要用户深入理解各个组件配置       |
| **灵活性**     | 相对较低，基于默认配置进行部署        | 非常灵活，完全控制每个组件的部署和配置 |
| **集群升级**   | 提供自动化的集群升级路径              | 升级时需要手动操作，容易出错           |