# æ— çŠ¶æ€åº”ç”¨ç®¡ç† Deployment

## 3.1 ä»€ä¹ˆæ˜¯ Deploymentï¼Ÿ

**Deployment** æ˜¯ Kubernetes ä¸­ç”¨äºç®¡ç†æ— çŠ¶æ€åº”ç”¨çš„å·¥ä½œè´Ÿè½½çš„ APIã€‚ä¸»è¦ç”¨äºç®¡ç†æ— çŠ¶æ€çš„åº”ç”¨ç¨‹åºï¼Œå®ƒæä¾›äº†ä¸€ç§å£°æ˜å¼çš„æ–¹å¼æ¥æè¿°åº”ç”¨çš„æœŸæœ›çŠ¶æ€ï¼Œç¡®ä¿éƒ¨ç½²è¿‡ç¨‹ä¸­çš„å¹³æ»‘è¿‡æ¸¡å’Œå›æ»šã€‚

**ä¸»è¦ç‰¹ç‚¹ï¼š**

- é€‚ç”¨äºæ— çŠ¶æ€æœåŠ¡ï¼ˆStateless Servicesï¼‰ã€‚
- æ”¯æŒæ»šåŠ¨æ›´æ–°ï¼ˆRolling Updateï¼‰å’Œå›æ»šï¼ˆRollbackï¼‰ã€‚
- è‡ªåŠ¨ç®¡ç† ReplicaSet å’Œ Podã€‚
- ç¡®ä¿åº”ç”¨åœ¨æ›´æ–°è¿‡ç¨‹ä¸­ä¿æŒå¯ç”¨ã€‚

## 3.2 Deployment çš„ YAML é…ç½®è§£é‡Š

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„ Deployment YAML é…ç½®æ–‡ä»¶ï¼š

```yaml
apiVersion: apps/v1              # æŒ‡å®šä½¿ç”¨ apps/v1 API ç‰ˆæœ¬
kind: Deployment                 # å®šä¹‰è¿™æ˜¯ä¸€ä¸ª Deployment
metadata:
  name: nginx-deployment         # Deployment çš„åç§°
  labels:
    app: nginx                   # ä¸º Deployment æ·»åŠ æ ‡ç­¾ï¼Œæ–¹ä¾¿ç®¡ç†
spec:
  replicas: 3                    # æŒ‡å®šè¦åˆ›å»º 3 ä¸ªå‰¯æœ¬
  selector:                      # å®šä¹‰é€‰æ‹©å™¨ï¼Œç”¨äºç­›é€‰ç®¡ç†çš„ Pod
    matchLabels:                 # ä½¿ç”¨åŸºäºæ ‡ç­¾çš„é€‰æ‹©å™¨
      app: nginx                 # é€‰æ‹©æ‰€æœ‰æ ‡ç­¾ app=nginx çš„ Pod
  template:                      # å®šä¹‰ Pod çš„æ¨¡æ¿
    metadata:
      labels:
        app: nginx               # ä¸º Pod æ·»åŠ æ ‡ç­¾ï¼Œç¡®ä¿ä¸ selector åŒ¹é…
    spec:
      containers:
      - name: nginx               # å®¹å™¨åç§°
        image: m.daocloud.io/docker.io/library/nginx:1.16      # ä½¿ç”¨çš„ Docker é•œåƒ
        ports:
        - containerPort: 80        # æš´éœ²å®¹å™¨çš„ 80 ç«¯å£
```

## 3.3 Deployment åŸºç¡€æ“ä½œ

### 3.3.1 åˆ›å»º Deployment

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»º Deploymentï¼š

```bash
root@k8s-master:~/yaml# kubectl create -f dp-nginx.yaml
deployment.apps/nginx-deployment created
```

**æŸ¥çœ‹ Deployment çŠ¶æ€**

ä½¿ç”¨ `kubectl get` å’Œ `kubectl describe` æŸ¥çœ‹ Deployment çš„çŠ¶æ€ï¼š

```bash
root@k8s-master:~/yaml# kubectl get deploy
NAME               READY   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3/3     3            3           48m
root@k8s-master:~/yaml# kubectl get po
NAME                                READY   STATUS    RESTARTS   AGE
nginx-deployment-86876b6586-pq2gj   1/1     Running   0          4m46s
nginx-deployment-86876b6586-z2d2q   1/1     Running   0          10m
nginx-deployment-86876b6586-zwqzg   1/1     Running   0          2m8s


#å„åˆ—è¯´æ˜ï¼š
- READY: 		å°±ç»ªçš„ Pod æ•°é‡ / æ€»å‰¯æœ¬æ•°ã€‚
- UP-TO-DATE:	å·²æ›´æ–°åˆ°æœŸæœ›çŠ¶æ€çš„å‰¯æœ¬æ•°ã€‚
- AVAILABLE: 	å¯ç”¨çš„ Pod æ•°é‡ã€‚
- AGE: 			Deployment çš„è¿è¡Œæ—¶é—´ã€‚
```

**æŸ¥çœ‹æ­¤ Deployment å½“å‰å¯¹åº”çš„ ReplicaSetï¼š**

```bash
root@k8s-master:~# kubectl get rs -l app=nginx
NAME                          DESIRED   CURRENT   READY   AGE
nginx-deployment-86876b6586   3         3         3       15h

root@k8s-master:~# kubectl get po -l app=nginx
NAME                                READY   STATUS    RESTARTS   AGE
nginx-deployment-86876b6586-76kzl   1/1     Running   0          11h
nginx-deployment-86876b6586-h9qkh   1/1     Running   0          11h
nginx-deployment-86876b6586-rq8w9   1/1     Running   0          11h


#â¢ DESIREDï¼šåº”ç”¨ç¨‹åºå‰¯æœ¬æ•°ï¼›
#â¢ CURRENTï¼šå½“å‰æ­£åœ¨è¿è¡Œçš„å‰¯æœ¬æ•°ï¼›
```

â€‹	å½“ Deployment æœ‰è¿‡æ›´æ–°ï¼Œå¯¹åº”çš„ RS å¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼Œå¯ä»¥é€šè¿‡-o yaml è·å–å½“å‰å¯¹åº”çš„ RSæ˜¯å“ªä¸ªï¼Œå…¶ä½™çš„ RS ä¸ºä¿ç•™çš„å†å²ç‰ˆæœ¬ï¼Œç”¨äºå›æ»šç­‰æ“ä½œã€‚æŸ¥çœ‹æ­¤ Deployment åˆ›å»ºçš„ Podï¼Œå¯ä»¥çœ‹åˆ° Pod çš„ hash å€¼ 86876b6586å’Œä¸Šè¿° Deployment å¯¹åº”çš„ ReplicaSet çš„ hash å€¼ä¸€è‡´ï¼š

### 3.3.2 Deployment æ›´æ–°

> [!CAUTION]
>
> å½“ä¸”ä»…å½“ Deployment çš„ Pod æ¨¡æ¿ï¼ˆå³.spec.templateï¼‰æ›´æ”¹æ—¶ï¼Œæ‰ä¼šè§¦å‘ Deployment
> æ›´æ–°ï¼Œä¾‹å¦‚æ›´æ”¹å†…å­˜ã€CPU é…ç½®æˆ–è€…å®¹å™¨çš„ imageã€‚

å‡å¦‚æ›´æ–° Nginx Pod çš„ image ä½¿ç”¨ m.daocloud.io/docker.io/library/nginx:latestï¼Œå¹¶ä½¿ç”¨ --record è®°å½•å½“å‰æ›´æ”¹çš„å‚æ•°ï¼ŒåæœŸå›æ»šæ—¶å¯ä»¥æŸ¥çœ‹åˆ°å¯¹åº”çš„ä¿¡æ¯ï¼š

```bash
root@k8s-master:~# kubectl set image deployment/nginx-deployment nginx=m.daocloud.io/docker.io/library/nginx:latest --record
deployment.apps/nginx-deployment image updated
```

**æŸ¥çœ‹æ›´æ–°è¿‡åçš„é•œåƒä¿¡æ¯**

```bash
root@k8s-master:~# kubectl get deploy nginx-deployment -o yaml |grep image:
      - image: m.daocloud.io/docker.io/library/nginx:latest
```

**æŸ¥çœ‹èµ„æºå†å²çš„ç‰ˆæœ¬**

```bash
root@k8s-master:~# kubectl rollout history deployment/nginx-deployment
deployment.apps/nginx-deployment 
REVISION  CHANGE-CAUSE
2         <none>
3         kubectl set image deployment/nginx-deployment nginx=m.daocloud.io/docker.io/library/nginx:latest --record=true
```

**ğŸš¨æ³¨æ„**

**<span style="color:red">å¦‚æœä½¿ç”¨set å‘½ä»¤è¿›è¡Œèµ„æºæ›´æ–°ï¼Œåç»­å¦‚æœæƒ³é€šè¿‡åŸyamlæ–‡ä»¶è¿›è¡Œä¿®æ”¹æ›´æ–°é‚£ä¹ˆå°±éœ€è¦å…ˆå°†èµ„æºå¯¼å‡ºæˆä¸ºyamlæ–‡ä»¶ç„¶ååœ¨è¿›è¡Œç¼–è¾‘ä¿®æ”¹</span>**

**å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬**ï¼š

```bash
kubectl rollout undo deployment/nginx-deployment
```

### 3.3.3 Deployment æ‰©å®¹

**å‘½ä»¤æ‰©å®¹**

```bash
kubectl scale deployment <deployment_name> --replicas=<desired_number_of_replicas>
```

**ç¼–è¾‘ Deployment**

é€šè¿‡ `kubectl edit` å‘½ä»¤ï¼Œç›´æ¥ç¼–è¾‘ç°æœ‰ Deployment çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä¿®æ”¹ `spec.replicas` æ•°é‡æ¥å®ç°æ‰©å®¹ã€‚ç¼–è¾‘åï¼ŒKubernetes ä¼šè‡ªåŠ¨æ›´æ–° Pods çš„æ•°é‡

```bash
kubectl edit deployment <deployment_name>
```

**ä¿®æ”¹ YAML æ–‡ä»¶å¹¶åº”ç”¨**

```bash
kubectl apply -f <deployment_yaml_file>
```

### 3.3.4 æš‚åœå’Œæ¢å¤ Deployment æ›´æ–°

ä¸Šè¿°æ¼”ç¤ºçš„å‡ä¸ºæ›´æ”¹æŸä¸€å¤„çš„é…ç½®ï¼Œæ›´æ”¹åç«‹å³è§¦å‘æ›´æ–°ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯èƒ½éœ€è¦é’ˆå¯¹ä¸€ä¸ªèµ„æºæ–‡ä»¶æ›´æ”¹å¤šå¤„åœ°æ–¹ï¼Œè€Œå¹¶ä¸éœ€è¦å¤šæ¬¡è§¦å‘æ›´æ–°ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ Deployment æš‚åœåŠŸèƒ½ï¼Œä¸´æ—¶ç¦ç”¨æ›´æ–°æ“ä½œï¼Œå¯¹ Deployment è¿›è¡Œå¤šæ¬¡ä¿®æ”¹ååœ¨è¿›è¡Œæ›´æ–°ã€‚ä½¿ç”¨ kubectl rollout pause å‘½ä»¤å³å¯æš‚åœ Deployment æ›´æ–°ï¼š

åœ¨è¿›è¡Œå¤šæ¬¡é…ç½®æ›´æ”¹æ—¶ï¼Œå¯ä»¥æš‚åœæ›´æ–°ï¼Œå®Œæˆåå†æ¢å¤ï¼š

```bash
kubectl rollout pause deployment/nginx-deployment
```

ç„¶åå¯¹ Deployment è¿›è¡Œç›¸å…³æ›´æ–°æ“ä½œï¼Œæ¯”å¦‚å…ˆæ›´æ–°é•œåƒï¼Œç„¶åå¯¹å…¶èµ„æºè¿›è¡Œé™åˆ¶ï¼ˆå¦‚æœä½¿ç”¨çš„æ˜¯ kubectl edit å‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œå¤šæ¬¡ä¿®æ”¹ï¼Œæ— éœ€æš‚åœæ›´æ–°ï¼Œkubectlset å‘½ä»¤ä¸€èˆ¬ä¼šé›†æˆåœ¨CICD æµæ°´çº¿ä¸­ï¼‰ï¼š

```bash
# kubectl set image deployment.v1.apps/nginx-deployment nginx=m.daocloud.io/docker.io/library/nginx:1.91
deployment.apps/nginx-deployment image updated

# kubectl set resources deployment.v1.apps/nginx-deployment -c=nginx --limits=cpu=200m,memory=512Mi
deployment.apps/nginx-deployment resource requirements updated
```

é€šè¿‡ rollout history å¯ä»¥çœ‹åˆ°æ²¡æœ‰æ–°çš„æ›´æ–°ï¼š

```bash
root@k8s-master:~# kubectl rollout history deployment/nginx-deployment
deployment.apps/nginx-deployment 
REVISION  CHANGE-CAUSE
2         <none>
3         kubectl set image deployment/nginx-deployment nginx=m.daocloud.io/docker.io/library/nginx:latest --record=true
```

**è¿›è¡Œå®Œæœ€åä¸€å¤„é…ç½®æ›´æ”¹åï¼Œä½¿ç”¨ kubectl rollout resume æ¢å¤ Deployment æ›´æ–°ï¼š**

```bash
kubectl rollout resume deployment/nginx-deployment

#æ¢å¤çŠ¶æ€åå¯ä»¥çœ‹åˆ°è‡ªåŠ¨æŠŠå‰é¢åšçš„ä¸¤æ¬¡å˜æ›´è¿›è¡Œäº†æ›´æ–°
root@k8s-master:~# kubectl rollout history deployment/nginx-deployment
deployment.apps/nginx-deployment 
REVISION  CHANGE-CAUSE
2         <none>
3         kubectl set image deployment/nginx-deployment nginx=m.daocloud.io/docker.io/library/nginx:latest --record=true
4         kubectl set image deployment/nginx-deployment nginx=m.daocloud.io/docker.io/library/nginx:latest --record=true
```

å¯ä»¥çœ‹åˆ°å·²ç»å‘ç”Ÿäº†å˜æ›´

```bash
root@k8s-master:~# kubectl get deploy nginx-deployment -o yaml |grep image:
      - image: m.daocloud.io/docker.io/library/nginx:1.91

root@k8s-master:~# kubectl describe deploy nginx-deployment
Name:                   nginx-deployment
Namespace:              default
CreationTimestamp:      Wed, 19 Feb 2025 08:41:33 +0000
Labels:                 app=nginx
Annotations:            deployment.kubernetes.io/revision: 4
                        kubernetes.io/change-cause: kubectl set image deployment/nginx-deployment nginx=m.daocloud.io/docker.io/library/nginx:latest --record=true
Selector:               app=nginx
Replicas:               3 desired | 1 updated | 4 total | 3 available | 1 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  25% max unavailable, 25% max surge
Pod Template:
  Labels:  app=nginx
  Containers:
   nginx:
    Image:      m.daocloud.io/docker.io/library/nginx:1.91
    Port:       80/TCP
    Host Port:  0/TCP
    Limits:
      cpu:        200m
      memory:     512Mi
```

## 3.4 æ›´æ–° Deployment çš„æ³¨æ„äº‹é¡¹

### å†å²ç‰ˆæœ¬æ¸…ç†ç­–ç•¥

åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒKubernetes ä¼šä¿ç•™ 10 ä¸ªæ—§çš„ ReplicaSetï¼Œå¤šä½™çš„ ReplicaSet ä¼šåœ¨åå°è¢«åƒåœ¾å›æ”¶ã€‚å¯ä»¥é€šè¿‡ `.spec.revisionHistoryLimit` è®¾ç½®ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°é‡ã€‚å¦‚æœå°†å…¶è®¾ç½®ä¸º `0`ï¼Œåˆ™ä¸ä¿ç•™ä»»ä½•å†å²ç‰ˆæœ¬ã€‚è¿™å¯¹äºæ§åˆ¶å†å²ç‰ˆæœ¬çš„å­˜å‚¨å’Œæ¸…ç†éå¸¸æœ‰ç”¨ï¼Œé¿å…é›†ç¾¤ä¸­ç§¯ç´¯è¿‡å¤šçš„å†å²å‰¯æœ¬ã€‚

### æ›´æ–°ç­–ç•¥

Kubernetes æä¾›äº†ä¸¤ç§æ›´æ–°ç­–ç•¥ï¼š

1. **Recreateï¼ˆé‡å»ºç­–ç•¥ï¼‰**
   `.spec.strategy.type == Recreate` è¡¨ç¤ºåœ¨æ›´æ–°æ—¶ï¼Œå…ˆåˆ é™¤æ—§çš„ Podï¼Œå†åˆ›å»ºæ–°çš„ Podã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºéœ€è¦ç¡®ä¿æ—§ Pod å®Œå…¨æ¶ˆå¤±åå†å¯åŠ¨æ–° Pod çš„åœºæ™¯ã€‚è¿™ç§ç­–ç•¥é€‚åˆä¸€äº›å¯¹æ›´æ–°è¿‡ç¨‹ä¸­æ²¡æœ‰ Pod å¯ç”¨è¦æ±‚è¾ƒä½çš„åœºæ™¯ï¼Œé€šå¸¸ç”¨äºæ— çŠ¶æ€æœåŠ¡æˆ–èµ„æºå……è¶³çš„ç¯å¢ƒã€‚

2. **RollingUpdateï¼ˆæ»šåŠ¨æ›´æ–°ç­–ç•¥ï¼‰**
   `.spec.strategy.type == RollingUpdate` è¡¨ç¤ºé€æ­¥æ›¿æ¢æ—§çš„ Podsï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ä¸ä¼šåœæœºã€‚æ»šåŠ¨æ›´æ–°é€šè¿‡æ§åˆ¶æ›´æ–°æ­¥é•¿å’Œä¸å¯ç”¨ Pod æ•°é‡æ¥é€æ­¥æ›¿æ¢æ—§çš„ Podï¼Œç¡®ä¿åœ¨æ›´æ–°è¿‡ç¨‹ä¸­åº”ç”¨å§‹ç»ˆæœ‰å¯ç”¨çš„ Podã€‚

   å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªå‚æ•°æ¥æ§åˆ¶æ»šåŠ¨æ›´æ–°çš„è¡Œä¸ºï¼š

   - **`.spec.strategy.rollingUpdate.maxUnavailable`**
     æŒ‡å®šåœ¨æ›´æ–°è¿‡ç¨‹ä¸­æœ€å¤§ä¸å¯ç”¨çš„ Pod æ•°é‡ã€‚å¯ä»¥è®¾ç½®ä¸ºæ•°å­—æˆ–ç™¾åˆ†æ¯”ï¼Œé»˜è®¤å€¼æ˜¯ `25%`ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½®ä¸º `25%`ï¼Œè¡¨ç¤ºåœ¨æ›´æ–°è¿‡ç¨‹ä¸­æœ€å¤šæœ‰ 25% çš„ Pod å¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚è‹¥è®¾ç½® `maxUnavailable` ä¸º 0ï¼Œåˆ™è¡¨ç¤ºæ›´æ–°è¿‡ç¨‹ä¸­ä¸ä¼šæœ‰ä»»ä½• Pod å˜ä¸ºä¸å¯ç”¨ã€‚
   - **`.spec.strategy.rollingUpdate.maxSurge`**
     æŒ‡å®šåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå…è®¸è¶…å‡ºæœŸæœ› Pod æ•°é‡çš„æœ€å¤§æ•°é‡ã€‚å¯ä»¥è®¾ç½®ä¸ºæ•°å­—æˆ–ç™¾åˆ†æ¯”ï¼Œé»˜è®¤å€¼æ˜¯ `25%`ã€‚å¦‚æœè®¾ç½®ä¸º `25%`ï¼Œè¡¨ç¤ºåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæœ€å¤šå…è®¸ Pod æ•°é‡æ¯”æœŸæœ›æ•°é‡å¤šå‡º 25%ã€‚è¿™ä¸ªå‚æ•°æœ‰åŠ©äºåœ¨æ›´æ–°æ—¶ä¿æŒè¶³å¤Ÿçš„ Pod æ¥å¤„ç†æµé‡ï¼Œé¿å…æœåŠ¡ä¸­æ–­ã€‚

   > **æ³¨æ„**ï¼šå¦‚æœå°† `maxUnavailable` è®¾ç½®ä¸º `0`ï¼Œè¡¨ç¤ºåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ä¸èƒ½æœ‰ Pod å˜ä¸ºä¸å¯ç”¨ï¼Œé‚£ä¹ˆ `maxSurge` å¿…é¡»å¤§äº 0ã€‚å› ä¸ºå¦‚æœæ²¡æœ‰ `maxSurge`ï¼Œå°±æ— æ³•ä¸ºæ›´æ–°è¿‡ç¨‹ä¸­çš„ä¸å¯ç”¨ Pod åˆ›å»ºæ–°çš„ Pod æ¥æ›¿ä»£ï¼Œä»è€Œæ— æ³•é¡ºåˆ©å®Œæˆæ›´æ–°ã€‚

**æ»šåŠ¨æ›´æ–°**

```yaml
spec:
  replicas: 3  # æœŸæœ›çš„ Pod å‰¯æœ¬æ•°
  revisionHistoryLimit: 5  # ä¿ç•™ 5 ä¸ªå†å²ç‰ˆæœ¬
  strategy:
    type: RollingUpdate  # ä½¿ç”¨æ»šåŠ¨æ›´æ–°ç­–ç•¥
    rollingUpdate:
      maxSurge: 25%  # å…è®¸è¶…å‡ºæœŸæœ›æ•°é‡çš„ Pod æœ€å¤§ä¸º 25%
      maxUnavailable: 25%  # æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæœ€å¤šå…è®¸ 25% çš„ Pod ä¸å¯ç”¨
      timeoutSeconds: 600  # æ»šåŠ¨æ›´æ–°æ¯æ¬¡å°è¯•çš„æœ€å¤§æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤ä¸º 600 ç§’
      partition: 2  # åªæ›´æ–°ç‰¹å®šç‰ˆæœ¬çš„ Podï¼Œæ§åˆ¶ä»å“ªäº›å‰¯æœ¬å¼€å§‹æ›´æ–°ï¼ˆä»…é€‚ç”¨äºå¤šç‰ˆæœ¬éƒ¨ç½²åœºæ™¯ï¼‰
  minReadySeconds: 10  # æ–°åˆ›å»ºçš„ Pod åœ¨è¢«è®¤ä¸ºå¯ç”¨ä¹‹å‰ï¼Œå¿…é¡»ä¿æŒå°±ç»ªçŠ¶æ€çš„æœ€å°æ—¶é—´ï¼Œå•ä½ä¸ºç§’
  progressDeadlineSeconds: 600  # æ›´æ–°è¿‡ç¨‹çš„æœ€é•¿å…è®¸æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œè‹¥è¶…è¿‡æ­¤æ—¶é—´æ›´æ–°æœªå®Œæˆï¼Œåˆ™è§¦å‘å›æ»š
```

 **é‡å»ºç­–ç•¥ (Recreate)**

```yaml
spec:
  replicas: 3  # æœŸæœ›çš„ Pod å‰¯æœ¬æ•°
  revisionHistoryLimit: 3  # ä¿ç•™ 3 ä¸ªå†å²ç‰ˆæœ¬
  strategy:
    type: Recreate  # ä½¿ç”¨é‡å»ºç­–ç•¥
```

### ä¸ºä»€ä¹ˆ `maxUnavailable` å’Œ `maxSurge` ä¸èƒ½åŒæ—¶ä¸º 0ï¼Ÿ

å¦‚æœå°† `maxUnavailable` è®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºåœ¨æ›´æ–°è¿‡ç¨‹ä¸­æ‰€æœ‰ Pod å¿…é¡»å§‹ç»ˆä¿æŒå¯ç”¨ã€‚å¦‚æœå°† `maxSurge` è®¾ç½®ä¸º 0ï¼Œåˆ™æ„å‘³ç€åœ¨æ›´æ–°è¿‡ç¨‹ä¸­ä¸èƒ½è¶…å‡ºæœŸæœ› Pod æ•°é‡çš„èŒƒå›´ï¼Œè¿™å°†å¯¼è‡´æ²¡æœ‰é¢å¤– Pod ç”¨æ¥æ›¿æ¢ä¸å¯ç”¨çš„ Podï¼Œæ— æ³•ä¿è¯æ›´æ–°çš„é¡ºåˆ©è¿›è¡Œã€‚å› æ­¤ï¼Œ`maxUnavailable` å’Œ `maxSurge` ä¸èƒ½åŒæ—¶ä¸º 0ï¼Œé¿å…æ›´æ–°æ— æ³•è¿›è¡Œã€‚

### å…¶ä»–ç›¸å…³å‚æ•°

é™¤äº† `maxUnavailable` å’Œ `maxSurge`ï¼Œä»¥ä¸‹å‚æ•°åœ¨æ»šåŠ¨æ›´æ–°è¿‡ç¨‹ä¸­ä¹Ÿèµ·åˆ°äº†é‡è¦ä½œç”¨ï¼š

- **`spec.minReadySeconds`**
  æŒ‡å®šæ–°åˆ›å»ºçš„ Pod åœ¨è¢«è®¤ä¸ºå¯ç”¨ä¹‹å‰ï¼Œå¿…é¡»ä¿æŒå°±ç»ªçŠ¶æ€çš„æœ€å°æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚é»˜è®¤å€¼ä¸º `0` ç§’ã€‚è¿™ä¸ªå‚æ•°æœ‰åŠ©äºç¡®ä¿æ–° Pod å®Œå…¨åˆå§‹åŒ–å¹¶å‡†å¤‡å¥½æ¥æ”¶æµé‡ï¼Œé¿å…è¿‡æ—©æ¥æ”¶æµé‡å¯¼è‡´æœåŠ¡ä¸ç¨³å®šã€‚
- **`spec.progressDeadlineSeconds`**
  æŒ‡å®šæ›´æ–°è¿‡ç¨‹ä¸­å…è®¸çš„æœ€é•¿æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ï¼Œå¦‚æœåœ¨æ­¤æ—¶é—´å†…æ›´æ–°è¿›ç¨‹æœªè¾¾åˆ°é¢„æœŸçš„çŠ¶æ€ï¼Œæ›´æ–°ä¼šè¢«è§†ä¸ºå¤±è´¥å¹¶è§¦å‘å›æ»šã€‚é»˜è®¤å€¼ä¸º `600` ç§’ã€‚è¯¥å‚æ•°å¸®åŠ©é˜²æ­¢æ›´æ–°è¿‡ç¨‹ä¸­å‘ç”Ÿæ­»é”æˆ–å¡ä½çš„æƒ…å†µã€‚
- **`spec.revisionHistoryLimit`**
  æ§åˆ¶å†å²ç‰ˆæœ¬çš„ ReplicaSet æ•°é‡ã€‚Kubernetes ä¼šä¿ç•™æœ€è¿‘ `n` ä¸ªå†å²ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º 10ï¼Œè®¾ç½®ä¸º 0 æ—¶ä¸ä¿ç•™ä»»ä½•å†å²ç‰ˆæœ¬ã€‚è¯¥å‚æ•°å¸®åŠ©ç®¡ç†æ—§ç‰ˆæœ¬çš„æ¸…ç†ã€‚
- **`spec.paused`**
  å¦‚æœè®¾ç½®ä¸º `true`ï¼ŒKubernetes å°†æš‚åœå½“å‰çš„æ»šåŠ¨æ›´æ–°ï¼Œç›´åˆ°ç”¨æˆ·æ‰‹åŠ¨æ¢å¤ã€‚è¿™åœ¨éœ€è¦æ§åˆ¶æ›´æ–°æ­¥ä¼æˆ–é¿å…è‡ªåŠ¨æ›´æ–°çš„åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ã€‚

### æ»šåŠ¨æ›´æ–°è¡Œä¸ºæ€»ç»“

- **æ»šåŠ¨æ›´æ–°çš„ä¼˜åŠ¿**ï¼šæ»šåŠ¨æ›´æ–°ç›¸æ¯”äºç›´æ¥é‡å»ºæ‰€æœ‰ Podï¼Œèƒ½å¤Ÿä¿è¯åœ¨æ›´æ–°è¿‡ç¨‹ä¸­å§‹ç»ˆæœ‰ä¸€éƒ¨åˆ† Pod å¯ç”¨ï¼Œä»è€Œæœ€å°åŒ–æœåŠ¡ä¸­æ–­çš„æ—¶é—´ã€‚å®ƒæ˜¯é«˜å¯ç”¨æ€§çš„å…³é”®ç­–ç•¥ä¹‹ä¸€ã€‚
- **æ›´æ–°æµç¨‹**ï¼šKubernetes ä¼šé€æ­¥åˆ›å»ºæ–° Podï¼Œå¹¶åœ¨æ–° Pod å¯åŠ¨æˆåŠŸååˆ é™¤æ—§ Podï¼Œç›´è‡³æ‰€æœ‰ Pod æ›´æ–°å®Œæˆã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œ`maxUnavailable` å’Œ `maxSurge` å…±åŒå†³å®šäº†æ›´æ–°çš„é€Ÿåº¦å’Œå®¹å¿çš„å¯ç”¨æ€§æŸå¤±ã€‚

### å®é™…åº”ç”¨ä¸­çš„æ³¨æ„äº‹é¡¹

- **æ€§èƒ½å’Œå¯ç”¨æ€§æƒè¡¡**ï¼šæ ¹æ®åº”ç”¨éœ€æ±‚ï¼Œåˆç†è®¾ç½® `maxUnavailable` å’Œ `maxSurge`ï¼š
  - å¦‚æœè¦æ±‚æœåŠ¡é«˜å¯ç”¨ï¼Œåº”è¯¥å°† `maxUnavailable` è®¾ç½®ä¸ºè¾ƒä½çš„å€¼ï¼ˆå¦‚ `0` æˆ–å°‘é‡ï¼‰ï¼Œç¡®ä¿åœ¨æ›´æ–°è¿‡ç¨‹ä¸­ä¿æŒè¶³å¤Ÿçš„å¯ç”¨ Podã€‚
  - å¦‚æœå¯ä»¥å®¹å¿éƒ¨åˆ† Pod çŸ­æ—¶é—´ä¸å¯ç”¨ï¼Œå¯ä»¥é€‚å½“å¢åŠ  `maxUnavailable`ï¼ŒåŒæ—¶é…ç½® `maxSurge` æ¥åŠ å¿«æ›´æ–°è¿‡ç¨‹ã€‚
- **èµ„æºé™åˆ¶**ï¼šå¦‚æœé›†ç¾¤èµ„æºæœ‰é™ï¼Œè®¾ç½®è¿‡é«˜çš„ `maxSurge` å¯èƒ½å¯¼è‡´èµ„æºè¶…è½½ï¼Œå½±å“å…¶ä»–æœåŠ¡çš„ç¨³å®šæ€§ã€‚å› æ­¤ï¼Œåº”è¯¥æ ¹æ®é›†ç¾¤èµ„æºçŠ¶å†µå’ŒæœåŠ¡éœ€æ±‚è°ƒæ•´è¿™äº›å‚æ•°ã€‚

